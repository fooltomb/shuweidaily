<!DOCTYPE html>
<html>
<head>
	<title>项目</title>
	<meta charset="utf-8">
	<script>
		function ChangeProject()
		{
			var f=document.forms['addproject'];
			var pro_id=f['project'].value;
			var list={{p_list|safe}};
			for (pro in list)
			{
				if(list[pro][0]==pro_id)
				{
					f['projectname'].value=list[pro][1];
					f['projectdetail'].value=list[pro][2];
					f['begin_date'].value=list[pro][3];
					f['end_date'].value=list[pro][4];
					if(list[pro][5])
					{
						f['isworking'][0].checked=true;
					}
					else
					{
						f['isworking'][1].checked=true;
					}
					f['reward'].value=list[pro][6];

				}
			}
		}
		function CheckAddProject()
		{
			var f=document.forms['addproject'];
			if(f['projectname'].value==null || f['projectname'].value=="")
			{
				alert("项目名称不能为空");
				return false;
			}
			if(f['begin_date'].value==null || f['begin_date'].value=="" || f['end_date'].value==null || f['end_date'].value=="")
			{
				alert("请填写项目起止日期");
				return false;
			}
			if(f['reward']==null || f['reward']=="")
			{
				alert("请填写项目提成");
				return false;
			}
		}
		function Searchpro(doing)
		{
			var f=document.forms["search"];
			if(doing)
			{
				f["project"].value=f["projectdoing"].value;
			}
			else
			{
				f["project"].value=f["projectdone"].value;
			}
			//alert(f["project"].value);
			f.submit();
		}
	</script>
</head>
<body>
<h2>项目查询</h2>

<form id="search" action="{% url 'dailyreport:project' %}" method="post">
	{% csrf_token %}
	<label>进行中的项目</label><select name="projectdoing">
		<option value=-1>全部</option>
		{% for p in project_list %}
		{% if p.isWorking %}
		<option value={{p.id}}>{{p.name}}</option>
		{% endif %}
		{% endfor %}
	</select>
	<label>完结的项目</label><select name="projectdone">
		<option value=-2>全部</option>
		{% for p in project_list %}
		{% if not p.isWorking %}
		<option value={{p.id}}>{{p.name}}</option>
		{% endif %}
		{% endfor %}
	</select>
	<input type="hidden" name="project">
	<label>起始日期</label><input type="date" name="begin_date" max={{today|date:"Y-m-d"}}>
	<label>结束日期</label><input type="date" name="end_date" max={{today|date:"Y-m-d"}}>
	<input type="button" value="查询" onclick='Searchpro(true)'>
	<input type="button" value="查询完结项目" onclick='Searchpro(false)'>
</form>

{% for project in return_list %}
<table border="1">
	<tr>
		{% for user in project.0 %}
		<th>{{user}}</th>
		{% endfor %}
	</tr>
	<tr>
		{% for weight in project.1 %}
		<td>{{weight}}</td>
		{% endfor %}
	</tr>
</table>
<br>
{% endfor %}
{% if is_super %}
<h2>你好，管理员</h2>
<p>添加新项目/修改旧项目</p>
<form onsubmit="return CheckAddProject()" name="addproject" action="{% url 'dailyreport:addproject' %}" method="post">
	{% csrf_token %}
	<label>项目名称</label><select name="project" onchange="ChangeProject()">
		<option value=-1>新项目</option>
		{% for p in project_list %}
		<option value={{p.id}}>{{p.name}}</option>
		{% endfor %}
	</select>
	<input type="text" name="projectname"><br>
	<label>项目描述</label><textarea name="projectdetail" cols="35" row="5" maxlength="250"></textarea><br>
	<label>启动日期</label><input type="date" name="begin_date"><br>
	<label>完结日期</label><input type="date" name="end_date"><br>
	<p>是否完结？（完结的项目，员工在日报里无法贡献）</p>
	<p><input type="radio" name="isworking" value="1" checked >正在进行中</p>
	<p><input type="radio" name="isworking" value="0" >已完结</p>
	<label>提成</label><input type="number" name="reward" min=0 >
	<br>
	<input type="submit" value="提交">
</form>
	<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<form name="delproject" action="{% url 'dailyreport:delproject' %}" method="post">
	{% csrf_token %}
	<label>项目名称</label><select name="project">
		{% for p in project_list %}
		<option value={{p.id}}>{{p.name}}</option>
		{% endfor %}
	</select>
	<input type="submit" value="删除">
</form>
{% endif %}
</body>
</html>
